---
layout: default
---

<!-- 上部タブ（既存CSSの nav スタイルを再利用） -->
<nav>
  <ul>
    <li><a href="{{ '/' | relative_url }}#about">About</a></li>
    <li><a href="{{ '/' | relative_url }}#works">Works/Plays</a></li>
    <li><a href="{{ '/' | relative_url }}#articles">Blog</a></li>
    <li><a href="{{ '/' | relative_url }}#contact">Contact</a></li>
  </ul>
</nav>

<article class="post">
  <header>
    <h1>{{ page.title }}</h1>
    <p class="article-date">{{ page.date | date: "%Y.%m.%d" }}</p>
  </header>

  {% if page.toc != false %}
  <!-- 目次（既存CSS: .table-of-contents を再利用） -->
  <aside class="table-of-contents" id="js-toc" aria-label="目次">
    <h2>目次</h2>
    <div class="toc-sections" id="js-toc-body"></div>
  </aside>
  {% endif %}

  <div class="post-body" id="js-post-body">
    {{ content }}
  </div>

</article>

<nav class="post-nav" aria-label="前後の記事">
  <div>
    {% if page.previous %}
      <a class="btn" href="{{ page.previous.url | relative_url }}" style="margin-bottom: 10px;">
        ← 前の記事：{{ page.previous.title }}
      </a>
    {% endif %}
  </div>

  <div>
    {% if page.next %}
      <a class="btn" href="{{ page.next.url | relative_url }}" style="margin-bottom: 10px;">
        次の記事：{{ page.next.title }} →
      </a>
    {% endif %}
  </div>
</nav>

{% include author-profile.html %}
{% include contact-footer.html %}

<script>
  window.addEventListener('load', () => {
    const postBody = document.getElementById('js-post-body');
    const toc = document.getElementById('js-toc');
    const tocBody = document.getElementById('js-toc-body');
    if (!postBody || !toc || !tocBody) return;

    // h2/h3 を拾って目次を作る（必要なら h4 も追加OK）
    const headings = postBody.querySelectorAll('h2, h3');

    // 見出しが少ない場合は目次を非表示（好みで閾値調整OK）
    if (headings.length < 2) {
      toc.style.display = 'none';
      return;
    }

    // id が無い見出しに id を付ける
    const slugify = (s) =>
      s.trim()
        .toLowerCase()
        .replace(/[^\w\u3040-\u30ff\u3400-\u9fff\u3005\u30a0-\u30ffー]+/g, '-') // 日本語も雑に許可
        .replace(/-+/g, '-')
        .replace(/^-|-$/g, '');

    const used = new Set();
    const ensureUniqueId = (base) => {
      let id = base || 'section';
      let i = 1;
      while (used.has(id) || document.getElementById(id)) {
        id = `${base}-${i++}`;
      }
      used.add(id);
      return id;
    };

    // 目次DOM構築（あなたのCSSの toc-* を使う）
    // 構造は：.toc-sections の下に <a> を並べるだけでもOK
    // ただ、既存CSSに合わせて .toc-section を使う
    headings.forEach(h => {
      const text = h.textContent.trim();
      if (!text) return;

      if (!h.id) {
        h.id = ensureUniqueId(slugify(text));
      }

      const level = h.tagName.toLowerCase(); // h2 / h3
      const a = document.createElement('a');
      a.href = `#${h.id}`;
      a.className = 'toc-section';
      a.style.display = 'block';
      a.style.textDecoration = 'none';

      // h2/h3で少しインデント（必要なければ削ってOK）
      a.style.marginLeft = (level === 'h3') ? '16px' : '0';

      // 見た目はCSS側に寄せたいので、テキストはシンプルに
      const title = document.createElement('h3');
      title.textContent = text;
      title.style.margin = '0';

      a.appendChild(title);
      tocBody.appendChild(a);
    });
  });
</script>

